{% extends 'base.html.twig' %}

{% block title %}
	{{ app.user.fname }}
	{{ app.user.lname }}
{% endblock %}

{% block body %}
	<style>
		.container {
			max-width: 1200px;
		}
		img.rounded-circle {
			border: 4px solid #007bff;
		}
		form button {
			width: 100%;
		}
		.btn-primary {
			background-color: #007bff;
			border: none;
		}
		.btn-primary:hover {
			background-color: #0056b3;
		}
		.btn-danger {
			background-color: #dc3545;
			border: none;
		}
		.btn-danger:hover {
			background-color: #c82333;
		}
	</style>

	<div class="container mt-5 pt-4">
		<nav class="nav nav-pills justify-content-center mb-4">
			<a class="nav-link" href="{{ path('app_dashboard') }}">Tableau de bord</a>
			<a class="nav-link active" href="{{ path('app_user_settings') }}">Paramètres</a>
			<a class="nav-link" href="#">Support</a>
		</nav>

		<div class="row">
			<div class="col-lg-4 text-center">
				<h4 class="mb-3">Votre Photo de Profil</h4>
				{% if app.user.googleId and app.user.photo starts with 'http' %}
					<img id="profileImage" src="{{ app.user.photo }}" alt="User Avatar" class="rounded-circle mb-3" width="150" height="150">
				{% else %}
					<img id="profileImage" src="{{ asset("public/users/img/"~app.user.photo) }}" alt="User Avatar" class="rounded-circle mb-3" width="150" height="150">
				{% endif %}

				<!-- Formulaire de mise à jour de l'avatar -->
				<form action="{{ path('app_user_settings_update') }}" method="POST" enctype="multipart/form-data">
					<div class="mb-3">
						<label for="avatarUpload" class="form-label">Changer l'avatar</label>
						<input class="form-control" type="file" name="avatarUpload" id="avatarUpload" accept="image/*" onchange="previewImage(event)">
					</div>
					<button type="submit" class="btn btn-primary">Mettre à jour</button>
				</form>
			</div>

			<div
				class="col-lg-8">
				<!-- Formulaire de mise à jour des informations personnelles -->
				<h4 class="mb-4">Informations personnelles</h4>
				<form action="{{ path('app_user_settings_update') }}" method="POST">
					<div class="mb-3">
						<label for="username" class="form-label">Nom d'utilisateur</label>
						<input type="text" class="form-control" name="username" id="username" value="{{ app.user.username }}" required>
					</div>
					<div class="mb-3">
						<label for="email" class="form-label">Email</label>
						<input type="email" class="form-control" name="email" id="email" value="{{ app.user.email }}" required>
					</div>
					<button type="submit" class="btn btn-primary">Sauvegarder les modifications</button>
				</form>

				<!-- Formulaire de mise à jour du mot de passe -->
				<h4 class="mt-5 mb-4">Sécurité du compte</h4>
				<form action="{{ path('app_user_settings_update') }}" method="POST">
					<div class="mb-3">
						<label for="currentPassword" class="form-label">Mot de passe actuel</label>
						<input type="password" class="form-control" name="currentPassword" id="currentPassword" required>
					</div>
					<div class="mb-3">
						<label for="newPassword" class="form-label">Nouveau mot de passe</label>
						<input type="password" class="form-control" name="newPassword" id="newPassword" required>
					</div>
					<div class="mb-3">
						<label for="confirmPassword" class="form-label">Confirmer le nouveau mot de passe</label>
						<input type="password" class="form-control" name="confirmPassword" id="confirmPassword" required>
					</div>
					<button type="submit" class="btn btn-danger">Changer le mot de passe</button>
				</form>

				<!-- Formulaire de mise à jour des préférences de notifications -->
				<h4 class="mt-5 mb-4">Notifications</h4>
				<form action="{{ path('app_user_settings_update') }}" method="POST">
					<div class="form-check mb-3">
						<input class="form-check-input" type="checkbox" name="emailNotifications" id="emailNotifications" {% if app.user.emailNotifications %} checked {% endif %}>
						<label class="form-check-label" for="emailNotifications">
							Recevoir des notifications par email
						</label>
					</div>
					<button type="submit" class="btn btn-primary">Sauvegarder les préférences</button>
				</form>
			</div>
		</div>
	</div>

	<!-- Script pour prévisualiser l'image sélectionnée -->
	 <script>
						    function previewImage(event) {
						        const input = event.target;
						        const reader = new FileReader();
						        reader.onload = function() {
						            const imageElement = document.getElementById('profileImage');
						            imageElement.src = reader.result;
						        };
						        if (input.files && input.files[0]) {
						            reader.readAsDataURL(input.files[0]);
						        }
						    }
						</script>
{% endblock %}
