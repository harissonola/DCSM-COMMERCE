# config/packages/nelmio_security.yaml
nelmio_security:
    # signs/verifies all cookies
    signed_cookie:
        names: ['*'] # Attention : connexion peut échouer si tous les cookies sont signés.

    # protection contre le clickjacking
    clickjacking:
        paths:
            '^/.*': DENY

    # désactivation du content‑type sniffing
    content_type:
        nosniff: true

    # politique de referrer
    referrer_policy:
        enabled: true
        policies:
            - 'strict-origin-when-cross-origin'
            - 'no-referrer'

    # empêche les redirections hors de ton domaine
    external_redirects:
        abort: true
        log: true

    # Content Security Policy
    csp:
        hosts: []
        content_types: []
        enforce:
            # URL de collecte des rapports CSP (optionnel, supprime si tu ne veux pas de rapport)
            report-uri: '%router.request_context.base_url%/nelmio/csp/report'

            # Défaut : uniquement ton domaine
            default-src:
                - 'self'

            # Scripts autorisés
            script-src:
                - 'self'
                - 'unsafe-inline'          # pour les petits scripts inline (importmap, AOS init…)
                - cdn.jsdelivr.net         # jQuery, Bootstrap, Sneat CSS/JS, Apex‑Charts, AOS, SweetAlert2…
                - cdnjs.cloudflare.com     # animate.css, Font‑Awesome
                - cdn.datatables.net       # DataTables JS
                - code.tidio.co            # widget de chat Tidio

            # Styles autorisés
            style-src:
                - 'self'
                - 'unsafe-inline'          # pour overrides inline (Tailwind overrides, demo.css…)
                - cdn.jsdelivr.net         # Sneat core & vendor CSS, Bootstrap‑Icons, Boxicons…
                - cdnjs.cloudflare.com     # animate.css, Font‑Awesome
                - cdn.datatables.net       # DataTables CSS

            # Images autorisées
            img-src:
                - 'self'
                - data:
                - raw.githubusercontent.com

            # Polices autorisées
            font-src:
                - 'self'
                - cdn.jsdelivr.net
                - cdnjs.cloudflare.com

            # Requêtes AJAX / WebSocket
            connect-src:
                - 'self'
                - api.tatum.io             # si tu appelles l’API Tatum côté client
                - wss://code.tidio.co      # WebSocket Tidio

            # iFrames (YouTube, etc.)
            frame-src:
                - 'self'

            # Interdire tout plugin natif
            object-src:
                - 'none'

            # Restreindre les formulaires à ton domaine
            form-action:
                - 'self'

            # Restreindre la base URI à ton domaine
            base-uri:
                - 'self'

            # Interdire l’enchâssement dans d’autres sites
            frame-ancestors:
                - 'none'

            # Bloquer le contenu mixte HTTP/HTTPS
            block-all-mixed-content: true

            # Forcer la mise à niveau des requêtes HTTP vers HTTPS
            upgrade-insecure-requests: true

            # Manifest web app
            manifest-src:
                - 'self'

            # Types de plugins acceptés (ici seulement JS & CSS)
            plugin-types:
                - 'application/javascript'
                - 'text/css'