{% extends 'base.html.twig' %}

{% block title %}Profil Utilisateur
{% endblock %}

{% block body %}
	<style>
		body {
			background: linear-gradient(135deg, #FFA500, #1E90FF);
			min-height: 100vh;
			color: #fff;
			font-family: 'Arial', sans-serif;
		}
		.profile-card {
			background-color: rgba(255, 255, 255, 0.15);
			backdrop-filter: blur(10px);
			border-radius: 15px;
			padding: 30px;
			margin-top: 50px;
			box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
		}
		.profile-img {
			width: 100px;
			height: 100px;
			object-fit: cover;
			border: 5px solid #fff;
			border-radius: 50%;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
		}
		.btn-deposit,
		.btn-withdraw,
		.btn-edit {
			border: none;
			color: #fff;
			padding: 10px 20px;
			border-radius: 5px;
			transition: background-color 0.3s;
			text-decoration: none;
		}
		.btn-deposit {
			background-color: #FFA500;
		}
		.btn-deposit:hover {
			background-color: #e69500;
		}
		.btn-withdraw {
			background-color: #1E90FF;
		}
		.btn-withdraw:hover {
			background-color: #187bcd;
		}
		.btn-edit {
			background-color: #28a745;
		}
		.btn-edit:hover {
			background-color: #218838;
		}
		.table-custom {
			background-color: rgba(255, 255, 255, 0.2);
		}
		.table-custom th,
		.table-custom td {
			color: #fff;
		}
		.table-custom thead th {
			border-bottom: 2px solid rgba(255, 255, 255, 0.5);
		}
	</style>
	<div class="container">
		<div class="row justify-content-center py-5 mt-3">
			<div class="col-md-8 profile-card">
				<div class="d-flex align-items-center mb-4">
					{% if app.user.googleId and app.user.photo starts with 'http' %}
						<img src="{{ app.user.photo }}" alt="Photo de profil" class="profile-img me-3 img-fluid">
					{% else %}
						<img src="/uploads/users/{{ app.user.photo }}" alt="Photo de profil" class="profile-img me-3 img-fluid">
					{% endif %}
					<div class="float-start">
						<h2 class="mb-0">{{ app.user.fname }}
							{{ app.user.lname }}</h2>
						<small class="text-muted">{{ app.user.username }}</small>
						<p>{{ app.user.email }}</p>
						<h5>Solde:
							<span class="fw-bold">${{ app.user.balance }}</span>
						</h5>
					</div>
					<div class="float-end">
						<img src="{{ app.user.qrCodePath }}" alt="QR Code" class="img-fluid" height="100px" width="100px" crossorigin="anonymous">
					</div>
				</div>
				<div class="mb-4">
					<a href="{{ path('app_user_settings') }}" class="btn-edit me-2 btn btn-success">Modifier le profil</a>
					<a href="#" class="btn-deposit me-2 btn btn-warning" data-bs-toggle="modal" data-bs-target="#depositModal">Faire un dépôt</a>
					<a href="#" class="btn-withdraw btn btn-primary" data-bs-toggle="modal" data-bs-target="#withdrawModal">Retirer des fonds</a>
				</div>

				<div>
					<h4>Historique des transactions</h4>
					<div class="table-responsive">
						<table class="table table-custom table-striped">
							<thead>
								<tr>
									<th>Date</th>
									<th>Méthode</th>
									<th>Montant</th>
								</tr>
							</thead>
							<tbody>
								{% for transaction in transactions %}
									<tr>
										<td>{{ transaction.createdAt|date('d/m/Y') }}</td>
										<td>{{ transaction.method }}</td>
										<td>${{ transaction.amount }}</td>
									</tr>
								{% else %}
									<tr>
										<td colspan="3">Aucune transaction trouvée.</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Dépôt -->
	<div class="modal fade" id="depositModal" tabindex="-1" aria-labelledby="depositModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="depositModalLabel">Faire un dépôt</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="{{ path('app_deposit') }}" method="post">
						<div class="mb-3">
							<label for="amount" class="form-label">Montant (USDT)</label>
							<input type="number" name="amount" required class="form-control">
						</div>
						<div class="mb-3">
							<label for="paymentMethod" class="form-label">Méthode de paiement</label>
							<select name="paymentMethod" id="paymentMethod" required class="form-control">
								<option value="">-- Choisissez --</option>
								<option value="crypto">Crypto</option>
								<option value="paypal">PayPal</option>
								<option value="mobilemoney">Mobile Money</option>
								<option value="carte">Carte</option>
							</select>
						</div>

						<!-- Section Crypto -->
						<div id="cryptoFields" style="display: none;">
							<div class="mb-3">
								<label for="cryptoType" class="form-label">Type de Crypto</label>
								<select name="cryptoType" class="form-control">
									<option value="BTC">BTC</option>
									<option value="TRX">TRX</option>
									<option value="USDT">USDT</option>
								</select>
							</div>
							<div class="mb-3">
								<label for="walletAddress" class="form-label">Adresse du portefeuille</label>
								<input type="text" name="walletAddress" class="form-control">
							</div>
						</div>

						<!-- Section PayPal -->
						<div id="paypalFields" style="display: none;">
							<div class="mb-3">
								<label for="paypalEmail" class="form-label">Email PayPal</label>
								<input type="email" name="paypalEmail" class="form-control" placeholder="votre-email@exemple.com">
							</div>
						</div>

						<!-- Section Mobile Money -->
						<div id="mobilemoneyFields" style="display: none;">
							<div class="mb-3">
								<label for="mobilemoneyProvider" class="form-label">Fournisseur Mobile Money</label>
								<select name="mobilemoneyProvider" class="form-control">
									<option value="mtn">MTN</option>
									<option value="orange">Orange</option>
									<option value="vodafone">Vodafone</option>
								</select>
							</div>
							<div class="mb-3">
								<label for="mobilemoneyNumber" class="form-label">Numéro de téléphone</label>
								<input type="text" name="mobilemoneyNumber" class="form-control" placeholder="Ex: 00225XXXXXXXX">
							</div>
						</div>

						<!-- Section Carte -->
						<div id="carteFields" style="display: none;">
							<div class="mb-3">
								<label for="cardNumber" class="form-label">Numéro de carte</label>
								<input type="text" name="cardNumber" class="form-control" placeholder="XXXX-XXXX-XXXX-XXXX">
							</div>
							<div class="mb-3">
								<label for="cardExpiry" class="form-label">Date d'expiration</label>
								<input type="text" name="cardExpiry" class="form-control" placeholder="MM/YY">
							</div>
							<div class="mb-3">
								<label for="cardCVC" class="form-label">CVC</label>
								<input type="text" name="cardCVC" class="form-control" placeholder="123">
							</div>
						</div>

						<button type="submit" class="btn-deposit">Déposer</button>
					</form>
				</div>
			</div>
		</div>
	</div>


	<!-- Modal Retrait -->
	<div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="withdrawModalLabel">Retirer des fonds</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="{{ path('app_withdraw') }}" method="post">
						<div class="mb-3">
							<label for="amount" class="form-label">Montant (USDT)</label>
							<input type="number" name="amount" required class="form-control">
						</div>
						<div class="mb-3">
							<label for="recipient" class="form-label">Adresse de réception</label>
							<input type="text" name="recipient" required class="form-control">
						</div>
						<button type="submit" class="btn-withdraw">Retirer</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	 <script>
		    // Fonction pour masquer toutes les sections
		    function hideAllPaymentFields() {
		        document.getElementById('cryptoFields').style.display = 'none';
		        document.getElementById('paypalFields').style.display = 'none';
		        document.getElementById('mobilemoneyFields').style.display = 'none';
		        document.getElementById('carteFields').style.display = 'none';
		    }
		
		    document.getElementById('paymentMethod').addEventListener('change', function() {
		        hideAllPaymentFields();
		        var selectedMethod = this.value;
		        if (selectedMethod === 'crypto') {
		            document.getElementById('cryptoFields').style.display = 'block';
		        } else if (selectedMethod === 'paypal') {
		            document.getElementById('paypalFields').style.display = 'block';
		        } else if (selectedMethod === 'mobilemoney') {
		            document.getElementById('mobilemoneyFields').style.display = 'block';
		        } else if (selectedMethod === 'carte') {
		            document.getElementById('carteFields').style.display = 'block';
		        }
		    });
		</script>

{% endblock %}
