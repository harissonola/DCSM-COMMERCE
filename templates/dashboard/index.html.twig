{% extends 'base.html.twig' %}

{% block title %}Dashboard
{% endblock %}

{% block body %}
    <style>
        /* Styles des cartes réelles */
        .shop-card {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateY(0);
            opacity: 0;
            animation: cardEntrance 0.6s forwards;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        @keyframes cardEntrance {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .shop-card:hover {
            transform: translateY(-5px) !important;
            box-shadow: 0 15px 20px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        .shop-card img {
            transition: transform 0.5s ease;
            height: 200px;
            object-fit: cover;
        }

        .shop-card:hover img {
            transform: scale(1.05);
        }

        .shop-card .card-body {
            position: relative;
            z-index: 2;
        }

        .shop-card .btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .shop-card .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .shop-card .btn:hover::after {
            left: 100%;
        }

        /* Animation séquentielle des cartes */
        .shop-card:nth-child(1) {
            animation-delay: 0.1s;
        }
        .shop-card:nth-child(2) {
            animation-delay: 0.2s;
        }
        .shop-card:nth-child(3) {
            animation-delay: 0.3s;
        }
        .shop-card:nth-child(4) {
            animation-delay: 0.4s;
        }
        .shop-card:nth-child(5) {
            animation-delay: 0.5s;
        }
    </style>

    <main id="main" class="main container py-5">
        <h2 class="text-center text-warning py-4 fw-bold" data-aos="zoom-in">Nos Boutiques</h2>

        <div class="row g-4" id="shop-container">
            <!-- Contenu dynamique -->
        </div>
    </main>
{% endblock %}

{% block customScript %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Si Turbo est actif, on attend turbo:load
            if (typeof Turbo !== 'undefined') {
                document.addEventListener('turbo:load', loadShops);
            } else {
                loadShops();
            }
        });

        function loadShops() {
            const shopContainer = document.getElementById('shop-container');
            if (!shopContainer) return;

            // Simule un délai de chargement (à remplacer par un vrai fetch)
            setTimeout(() => {
                fetchShopsData()
                    .then(shops => {
                        renderShops(shops);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        shopContainer.innerHTML = `
                            <div class="col-12 text-center py-5">
                                <div class="error-animation">
                                    <i class="fas fa-exclamation-triangle fa-3x text-danger mb-4"></i>
                                    <h4 class="text-light">Erreur de chargement</h4>
                                    <button class="btn btn-warning mt-3 pulse" onclick="window.location.reload()">
                                        <i class="fas fa-sync-alt me-2"></i> Réessayer
                                    </button>
                                </div>
                            </div>
                        `;
                    });
            }, 1000);
        }

        function fetchShopsData() {
            return new Promise((resolve) => {
                // En production: return fetch('/api/shops').then(r => r.json());
                const shops = {{ shops|json_encode|raw }} || [];
                resolve(shops);
            });
        }

        function renderShops(shops) {
            const shopContainer = document.getElementById('shop-container');
            if (!shopContainer) return;

            if (shops && shops.length > 0) {
                shopContainer.innerHTML = shops.map((shop, index) => `
                    <div class="col-md-4">
                        <div class="card h-100 shop-card" style="animation-delay: ${index * 0.1}s">
                            <img src="${shop.image}" class="card-img-top" alt="${shop.name}" loading="lazy">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    <a class="text-decoration-none text-warning" href="/shop/${shop.slug}">
                                        ${shop.name}
                                    </a>
                                </h5>
                                <p class="card-text flex-grow-1">${shop.description}</p>
                                <div class="mt-auto">
                                    <a href="/shop/${shop.slug}" class="btn btn-warning w-100">
                                        <i class="fas fa-store me-2"></i> Visiter la boutique
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Initialise les animations
                initAnimations();
            } else {
                shopContainer.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <div class="empty-state">
                            <i class="fas fa-store-slash fa-3x text-muted mb-4"></i>
                            <h4 class="text-light">Aucune boutique disponible</h4>
                            <p class="text-muted">Revenez plus tard pour découvrir nos nouvelles boutiques</p>
                        </div>
                    </div>
                `;
            }
        }

        function initAnimations() {
            // Initialise AOS si disponible
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 800,
                    once: true
                });
            }

            // Animation au scroll
            const cards = document.querySelectorAll('.shop-card');
            cards.forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const delay = entry.target.style.animationDelay || '0s';
                            setTimeout(() => {
                                entry.target.style.opacity = '1';
                                entry.target.style.transform = 'translateY(0)';
                            }, parseFloat(delay) * 1000);
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });

                observer.observe(card);
            });
        }
    </script>
{% endblock %}