{% extends 'base.html.twig' %}

{% block title %}
  {{ shop.name }}
{% endblock %}

{% block body %}
  <style>
    .hero {
      padding: 100px 20px;
      text-align: center;
      background: no-repeat center center/cover;
      position: relative;
      background: linear-gradient(94.41deg, #193d91 -6.4%, #091f51 105.25%);
    }
    
    .prods {
      padding: 100px 20px;
    }
    
    .prod-card {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      transition: transform 0.3s;
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
    }

    /* Style du skeleton loader */
    .prod-card.skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite ease-in-out;
    }

    @keyframes loading {
      0% {
        background-position: -200% 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    .prod-card img {
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      height: 200px;
      background-color: #e0e0e0; /* Placeholder pour l'image */
      object-fit: cover;
    }
    
    .prod-card .card-body {
      padding: 15px;
    }

    .prod-card h5, .prod-card h6, .prod-card p {
      background-color: #e0e0e0; /* Placeholder pour le texte */
      height: 20px;
      margin-bottom: 10px;
    }

    .prod-card .card-title {
      width: 60%;
      height: 20px;
    }

    .prod-card .card-subtitle {
      width: 40%;
      height: 15px;
    }

    .prod-card .card-text {
      width: 80%;
      height: 15px;
    }

    .prod-card .btn {
      background-color: #e0e0e0; /* Placeholder pour le bouton */
      height: 35px;
      width: 120px;
    }

    .prod-card:hover {
      transform: translateY(-10px);
    }

  </style>

  <section style="overflow: hidden;" class="hero align-items-center justify-content-center text-center">
    <div class="container" data-aos-duration="2000" data-aos="slide-left" data-aos-delay="100">
      <h1 class="text-primary" data-aos-duration="2000" data-aos="slide-down" data-aos-delay="700">{{ shop.name }}</h1>
      <p class="text-muted" data-aos-duration="2000" data-aos="slide-up" data-aos-delay="900">{{ shop.description }}</p>
    </div>
  </section>

  <section class="prods" id="prods">
    <div class="row" id="prod-container">
      {% if prods %}
        {% for prod in prods %}
          <div class="col-md-4">
            <div class="card prod-card{% if not prod.image %} skeleton{% endif %}">
              <img src="{{ prod.image }}" class="card-img-top" alt="{{ prod.name }}-IMG-{{ loop.index }}" style="max-height: 273px; object-fit: cover;" />
              <div class="card-body">
                <h5 class="card-title">{{ prod.name }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{ prod.price }} CFA</h6>
                <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>

                {% if is_granted('ROLE_ADMIN') %}
                  <a href="{{ path('app_dashboard_product', { slug: prod.slug }) }}" class="btn btn-primary float-end">Visualiser</a>
                {% else %}
                  <a href="{{ path('app_buy_product', { slug: prod.slug }) }}" class="btn btn-outline-primary float-end">Acheter</a>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <h5 class="text-center text-danger">Aucun produit disponible pour le moment.</h5>
      {% endif %}
    </div>
  </section>

  <script>
    document.addEventListener('turbo:load', function() {
      // Sélectionner toutes les cartes de produits
      const prodCards = document.querySelectorAll('.prod-card');

      prodCards.forEach(card => {
        // Si l'image du produit est déjà chargée
        const img = card.querySelector('img');
        img.onload = function() {
          card.classList.remove('skeleton'); // Retirer la classe skeleton lorsque l'image est chargée
        };

        // Vérifier si l'image est déjà chargée (au cas où elle serait en cache)
        if (img.complete) {
          card.classList.remove('skeleton');
        }
      });
    });
  </script>

{% endblock %}