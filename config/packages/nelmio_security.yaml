# config/packages/nelmio_security.yaml
nelmio_security:
    # Protection contre le clickjacking
    clickjacking:
        paths:
            '^/.*': DENY

    # Désactivation du content-type sniffing
    content_type:
        nosniff: true

    # Politique de Referrer
    referrer_policy:
        enabled: true
        policies:
            - 'no-referrer'
            - 'strict-origin-when-cross-origin'

    # Empêche les redirections hors de ton domaine
    external_redirects:
        abort: true
        log: true

    # Content Security Policy
    csp:
        hosts: []
        content_types: []
        enforce:
            # Optionnel : collecte des rapports CSP
            report-uri: '%router.request_context.base_url%/nelmio/csp/report'

            # Par défaut, uniquement ton domaine
            default-src:
                - 'self'

            # Scripts autorisés (inline + CDN)
            script-src:
                - 'self'
                - 'unsafe-inline'
                - 'cdn.jsdelivr.net'
                - 'cdnjs.cloudflare.com'
                - 'cdn.datatables.net'
                - 'code.tidio.co'

            # Styles autorisés (inline + CDN)
            style-src:
                - 'self'
                - 'unsafe-inline'
                - 'cdn.jsdelivr.net'
                - 'cdnjs.cloudflare.com'
                - 'cdn.datatables.net'

            # Images autorisées (origine, data: et GitHub raw pour les OG images/favicons)
            img-src:
                - 'self'
                - 'data:'
                - 'raw.githubusercontent.com'

            # Polices autorisées (via CDN CSS)
            font-src:
                - 'self'
                - 'cdn.jsdelivr.net'
                - 'cdnjs.cloudflare.com'

            # Requêtes AJAX / WebSockets
            connect-src:
                - 'self'
                - 'api.tatum.io'
                - 'wss://code.tidio.co'

            # iFrames (aucune tierce ici, mais conservé pour la forme)
            frame-src:
                - 'self'

            # Interdire tout plugin natif
            object-src:
                - 'none'

            # Restreindre l’action des formulaires à ton domaine
            form-action:
                - 'self'

            # Restreindre la base URI à ton domaine
            base-uri:
                - 'self'

            # Empêcher l’enchâssement de ton site ailleurs
            frame-ancestors:
                - 'none'

            # Types de plugins acceptés (JS & CSS uniquement)
            plugin-types:
                - 'application/javascript'
                - 'text/css'

            # Bloquer le contenu mixte HTTP/HTTPS
            block-all-mixed-content: true

            # Forcer la mise à niveau des requêtes HTTP vers HTTPS
            upgrade-insecure-requests: true